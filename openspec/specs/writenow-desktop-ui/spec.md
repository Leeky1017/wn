# Spec: writenow-desktop-ui

## Purpose

Define the non-negotiable desktop UI structure and UX expectations for WriteNow (Electron + React) so the app matches `demo.html` and remains writer-first (not an IDE).

## Requirements

### Requirement: Premium light theme tokens MUST be centralized

The UI theme MUST be defined via CSS variables extracted from `demo.html` and stored in:

- `frontend/src/styles/tokens.css`

#### Scenario: Tokens are a single source of truth
- **WHEN** updating the UI palette
- **THEN** changes are made via `tokens.css` variables (not scattered hex values)

### Requirement: Layout MUST follow the four-zone blueprint

The main window MUST be composed of four horizontal zones:

1. Activity Bar (48px fixed) — Library, Story Map, Search, Settings + language toggle
2. Sidebar (260px, collapsible) — Library (drafts) or Story Map (outline)
3. Workspace (flex: 1) — tabs, edit/preview toggle, paper canvas, status bar
4. AI Companion (320px fixed) — composer + Skills Library

#### Scenario: Writer-first canvas remains the hero
- **WHEN** the window is resized
- **THEN** the Workspace remains the primary flexible area and other zones retain fixed widths

### Requirement: Localization MUST be runtime-toggleable

The app MUST support `en` and `zh` dictionaries and provide a runtime language toggle (default `zh`).

#### Scenario: Toggle language updates labels immediately
- **WHEN** the user toggles language
- **THEN** visible UI labels update without reload and the document `lang` attribute reflects the active locale

### Requirement: Skills Library MUST persist locally and trigger AI actions

AI skills MUST be stored locally as JSON via Electron main process filesystem APIs and exposed to the renderer via IPC.

Skill shape:
`{ id, name, description, tag, promptTemplate }`

#### Scenario: Skills persist across restarts
- **WHEN** a user creates/edits a skill
- **THEN** it is written to a local JSON file under Electron `userData`
- **AND** it is loaded on next app launch

#### Scenario: Skill click triggers an AI run
- **WHEN** the user clicks a Skill card
- **THEN** the composer input is pre-filled and the AI agent is triggered through the existing WebSocket flow

### Requirement: Story Map MUST be regeneratable via backend

Story Map nodes MUST be rendered as a vertical flow list with indentation and connection lines.
The map MUST be generated by calling the backend and MUST NOT mutate user files.

Node shape:
`{ title, detail, depth }`

#### Scenario: Regenerate map calls backend
- **WHEN** the user clicks “Regenerate Map”
- **THEN** the renderer calls a backend endpoint and updates the Story Map nodes

### Requirement: Keyboard shortcuts MUST feel desktop-native

The app MUST provide:
- Cmd/Ctrl+S → Save
- Cmd/Ctrl+K → Skill palette / command entry

#### Scenario: Menu accelerators invoke renderer actions
- **WHEN** a user uses menu items or shortcuts
- **THEN** the renderer triggers the corresponding action without requiring DevTools

